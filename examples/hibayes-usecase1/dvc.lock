schema: '2.0'
stages:
  load:
    cmd: hibayes-load --config files/config.yaml --out .output/load/
    deps:
    - path: ../../src/hibayes/
      hash: md5
      md5: 10671688d1c30394f83e46a477793489.dir
      size: 459924
      nfiles: 106
    - path: files/custom_extractor.py
      hash: md5
      md5: ca187ea6dc725bcf36af1497a61b15ad
      size: 746
    params:
      files/config.yaml:
        data_loader:
          paths:
            files_to_process:
            - data/gpt-4o
          extractors:
            enabled:
            - base
            custom:
              path: files/custom_extractor.py
              classes:
              - Domains
    outs:
    - path: .output/load/
      hash: md5
      md5: 683f81ca23f6c1b3b434ce2f95c28f22.dir
      size: 132091
      nfiles: 1
  process:
    cmd: hibayes-process --config files/config.yaml --data 
      .output/load/data.parquet --out .output/process/
    deps:
    - path: ../../src/hibayes/
      hash: md5
      md5: 10671688d1c30394f83e46a477793489.dir
      size: 459924
      nfiles: 106
    - path: .output/load/data.parquet
      hash: md5
      md5: 89f3ed81c94fdf1991e681268d36350c
      size: 132091
    params:
      files/config.yaml:
        data_process:
          processors:
          - map_columns:
              column_mapping:
                domain: group
          - groupby:
              groupby_columns:
              - group
          - extract_features:
              feature_names:
              - n_total
          - extract_predictors:
              predictor_names:
              - group
          - extract_observed_feature:
              feature_name: n_correct
    outs:
    - path: .output/process/
      hash: md5
      md5: 6fee786d3ec40e3dfeb907793c4297ca.dir
      size: 132539
      nfiles: 4
  model:
    cmd: hibayes-model --config files/config.yaml --analysis-state 
      .output/process/ --out .output/model/
    deps:
    - path: ../../src/hibayes/
      hash: md5
      md5: 1b333ac4f15971ffc3fb7e815c211c6a.dir
      size: 461877
      nfiles: 106
    - path: .output/process/
      hash: md5
      md5: 6fee786d3ec40e3dfeb907793c4297ca.dir
      size: 132539
      nfiles: 4
    params:
      files/config.yaml:
        check:
          checkers:
          - prior_predictive_plot:
              plot_proportion: true
          - r_hat
          - divergences
          - ess_bulk
          - ess_tail
          - loo
          - bfmi
          - posterior_predictive_plot:
              plot_proportion: true
              plot_kwargs:
                num_pp_samples: 50
          - waic
        model:
          models:
          - name: two_level_group_binomial
            config:
              tag: version_1
              fit:
                samples: 1000
                chains: 4
                chain_method: vectorized
        platform:
          device_type: gpu
    outs:
    - path: .output/model/
      hash: md5
      md5: 8944a09379aaf2d85584a16366b919ad.dir
      size: 1859628
      nfiles: 14
  communicate:
    cmd: hibayes-comm --config files/config.yaml --analysis_state .output/model/
      --out .output/communicate/
    deps:
    - path: ../../src/hibayes/
      hash: md5
      md5: 1b333ac4f15971ffc3fb7e815c211c6a.dir
      size: 461877
      nfiles: 106
    - path: .output/model/
      hash: md5
      md5: 8944a09379aaf2d85584a16366b919ad.dir
      size: 1859628
      nfiles: 14
    params:
      files/config.yaml:
        communicate:
          communicate:
          - forest_plot:
              combined: true
          - trace_plot
          - summary_table
    outs:
    - path: .output/communicate/
      hash: md5
      md5: f3f0d87cc3fe516a3917b2188e4ecf14.dir
      size: 2622293
      nfiles: 16
