schema: '2.0'
stages:
  load:
    cmd: hibayes-load --config files/config.yaml --out .output/load/
    deps:
    - path: ../../src/hibayes/
      hash: md5
      md5: 33a0d116c39f00631368eff9b2616609.dir
      size: 390383
      nfiles: 83
    - path: files/extractors.py
      hash: md5
      md5: 5b005e480377dd0b3ddf8b8984100122
      size: 546
    params:
      files/config.yaml:
        data_loader:
          paths:
            files_to_process:
            - s3://aisi-data-eu-west-2-prod/users/harry-coppock/reasoning/gaia/7/
          extractors:
            enabled:
            - base
            - tokens
            - tools
            custom:
              path: files/extractors.py
              classes:
              - GaiaMetadataExtractor
    outs:
    - path: .output/load/
      hash: md5
      md5: e3f533ba86b4612b0625d66905592492.dir
      size: 335407
      nfiles: 1
  model:
    cmd: hibayes-model --config files/config.yaml --data .output/load/data.parquet
      --out .output/model/
    deps:
    - path: ../../src/hibayes/
      hash: md5
      md5: 33a0d116c39f00631368eff9b2616609.dir
      size: 390383
      nfiles: 83
    - path: .output/load/data.parquet
      hash: md5
      md5: 67bfec22c3309d4699f550d1f3891a39
      size: 335407
    - path: files/custom_checker.py
      hash: md5
      md5: 981305da3045dceaa447a94a7a22efb3
      size: 1100
    params:
      files/config.yaml:
        checkers:
          custom_checks:
            path: files/custom_checker.py
            checks:
            - posterior_mean_positive:
                param: mu_overall
                threshold: 0
          checks:
          - prior_predictive_plot
          - r_hat
          - divergences
          - ess_bulk
          - ess_tail
          - loo
          - bfmi
          - posterior_predictive_plot
          - waic
        model:
          models:
            ModelSampleEffects:
              mapping_name:
                score: success
                task: sample
              fit:
                chains: 4
                samples: 1000
                warmup: 500
        platform:
    outs:
    - path: .output/model/
      hash: md5
      md5: 2269ff42f84aa2cf4db12f0cfb0745ac.dir
      size: 43768088
      nfiles: 14
  communicate:
    cmd: hibayes-comm --config files/config.yaml --analysis_state .output/model/ --out
      .output/communicate/
    deps:
    - path: ../../src/hibayes/
      hash: md5
      md5: 33a0d116c39f00631368eff9b2616609.dir
      size: 390383
      nfiles: 83
    - path: .output/model/
      hash: md5
      md5: 2269ff42f84aa2cf4db12f0cfb0745ac.dir
      size: 43768088
      nfiles: 14
    params:
      files/config.yaml:
        communicate:
    outs:
    - path: .output/communicate/
      hash: md5
      md5: dcb63afd63b1aede0ddbffe9e0103c3b.dir
      size: 46331331
      nfiles: 11
